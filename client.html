<!DOCTYPE html>
<html>
<head>
    <title>WebRTC TV</title>
</head>
<body>
<video id="video" autoplay playsinline controls muted></video>
<audio id="audio" autoplay controls></audio>

<script>
    const video = document.getElementById('video');
    const audio = document.getElementById('audio');
    const ws = new WebSocket('ws://localhost:8080/ws');

    const pc = new RTCPeerConnection({
        iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
    });

    pc.ontrack = (event) => {
        const stream = new MediaStream();
        stream.addTrack(event.track);

        if (event.track.kind === 'video') {
            video.srcObject = stream;
        } else {
            audio.srcObject = stream;
        }
    };

    ws.onmessage = async (event) => {
        try {
            const offer = JSON.parse(event.data);
            await pc.setRemoteDescription(offer);
            const answer = await pc.createAnswer();
            await pc.setLocalDescription(answer);
            ws.send(JSON.stringify(answer));
        } catch (err) {
            console.error('WebRTC error:', err);
        }
    };

    pc.onicecandidate = ({ candidate }) => {
        if (candidate) {
            // Optional: Send candidates to server
        }
    };
</script>
</body>
</html>